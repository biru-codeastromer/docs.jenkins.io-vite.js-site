{
  "title": "Jenkins Security Advisory 2021-11-04",
  "date": "2021-11-04",
  "url": "/security/advisory/2021-11-04/",
  "kind": "core and plugin",
  "core": {
    "lts": {
      "previous": "2.303.2",
      "fixed": "2.303.3"
    },
    "weekly": {
      "previous": "2.318",
      "fixed": "2.319"
    }
  },
  "issues": [
    {
      "id": "SECURITY-2455",
      "reporter": "Daniel Beck, CloudBees, Inc.",
      "title": "Multiple vulnerabilities allow bypassing path filtering of agent-to-controller access control",
      "cve": "CVE-2021-21685, CVE-2021-21686, CVE-2021-21687, CVE-2021-21688, CVE-2021-21689, CVE-2021-21690, CVE-2021-21691, CVE-2021-21692, CVE-2021-21693, CVE-2021-21694, CVE-2021-21695",
      "cvss": {
        "severity": "Critical",
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H"
      },
      "description_adoc": "The agent-to-controller security subsystem limits which files on the Jenkins controller can be accessed by agent processes.\n\nMultiple vulnerabilities in the file path filtering implementation of Jenkins 2.318 and earlier, LTS 2.303.2 and earlier allow agent processes to read and write arbitrary files on the Jenkins controller file system, and obtain some information about Jenkins controller file systems.\n\n* SECURITY-2427 / CVE-2021-21685: `FilePath#mkdirs` does not check permission to create parent directories.\n* SECURITY-2444 / CVE-2021-21686: File path filters do not canonicalize paths, allowing operations to follow symbolic links to outside allowed directories.\n* SECURITY-2446 / CVE-2021-21687: `FilePath#untar` does not check permission to create symbolic links when unarchiving a symbolic link.\n* SECURITY-2484 / CVE-2021-21688: `FilePath#reading(FileVisitor)` does not reject any operations, allowing users to have unrestricted read access using certain operations (creating archives, `#copyRecursiveTo`).\n* SECURITY-2485 / CVE-2021-21689: `FilePath#unzip` and `FilePath#untar` were not subject to any access control.\n* SECURITY-2486 / CVE-2021-21690: Agent processes are able to completely bypass file path filtering by wrapping the file operation in an agent file path.\n* SECURITY-2531 / CVE-2021-21691: Creating symbolic links is possible without the `symlink` permission.\n* SECURITY-2538 / CVE-2021-21692: The operations `FilePath#renameTo` and `FilePath#moveAllChildrenTo` only check read permission on the source path.\n* SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is only checked after they've been created.\n* SECURITY-2541 / CVE-2021-21694: `FilePath#toURI`, `FilePath#hasSymlink`, `FilePath#absolutize`, `FilePath#isDescendant`, and `FilePath#get*DiskSpace` do not check any permissions.\n* SECURITY-2542 / CVE-2021-21695: `FilePath#listFiles` lists files outside directories with agent read access when following symbolic links.\n\nWe expect that most of these vulnerabilities have been present since link:/security/advisory/2014-10-30/[SECURITY-144 was addressed in the 2014-10-30 security advisory].\n\nJenkins 2.319, LTS 2.303.3 addresses these security vulnerabilities.\n\n* SECURITY-2427 / CVE-2021-21685: `FilePath#mkdirs` checks permission to create parent directories.\n* SECURITY-2444 / CVE-2021-21686: File path filters canonicalize paths, preventing operations from following symbolic links to outside allowed directories.\n* SECURITY-2446 / CVE-2021-21687: `FilePath#untar` checks permission to create symbolic links when unarchiving a symbolic link.\n* SECURITY-2484 / CVE-2021-21688: `FilePath#reading(FileVisitor)` correctly rejects operations if they operate on files outside allowed directories.\n* SECURITY-2485 / CVE-2021-21689: `FilePath#unzip` and `FilePath#untar` are now subject to access control.\n* SECURITY-2486 / CVE-2021-21690: Agent processes are no longer able to completely bypass file path filtering by wrapping the file operation in an agent file path.\n* SECURITY-2531 / CVE-2021-21691: Creating symbolic links now correctly checks the `symlink` permission.\n* SECURITY-2538 / CVE-2021-21692: The operations `FilePath#renameTo` and `FilePath#moveAllChildrenTo` check both `read` and `delete` permissions on the source path.\n* SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is checked before they are created based on an artificial path.\n* SECURITY-2541 / CVE-2021-21694: `FilePath#toURI`, `FilePath#hasSymlink`, `FilePath#absolutize`, `FilePath#isDescendant` check `stat` permission. `FilePath#get*DiskSpace` methods are no longer allowed to be executed by an agent.\n* SECURITY-2542 / CVE-2021-21695: `FilePath#listFiles` checks `stat` permission on files it returns, preventing listing files outside allowed directories.\n\nIMPORTANT: As some common operations are now newly subject to access control, it is expected that plugins sending commands from agents to the controller may start failing.\nAdditionally, the newly introduced path canonicalization means that instances using a custom builds directory (link:/doc/book/managing/system-properties/#jenkins-model-jenkins-buildsdir[Java system property `jenkins.model.Jenkins.buildsDir`]) or partitioning `JENKINS_HOME` using symbolic links may fail access control checks.\nSee link:/doc/book/security/controller-isolation/agent-to-controller/#file-access-rules[the documentation] for how to customize the configuration in case of problems.\n\nNOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].\nIt will prevent all agent-to-controller file access using `FilePath` APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.",
      "plugins": [],
      "components": [],
      "description_html": "<div class=\"paragraph\">\n<p>The agent-to-controller security subsystem limits which files on the Jenkins controller can be accessed by agent processes.</p>\n</div>\n<div class=\"paragraph\">\n<p>Multiple vulnerabilities in the file path filtering implementation of Jenkins 2.318 and earlier, LTS 2.303.2 and earlier allow agent processes to read and write arbitrary files on the Jenkins controller file system, and obtain some information about Jenkins controller file systems.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>SECURITY-2427 / CVE-2021-21685: <code>FilePath#mkdirs</code> does not check permission to create parent directories.</p>\n</li>\n<li>\n<p>SECURITY-2444 / CVE-2021-21686: File path filters do not canonicalize paths, allowing operations to follow symbolic links to outside allowed directories.</p>\n</li>\n<li>\n<p>SECURITY-2446 / CVE-2021-21687: <code>FilePath#untar</code> does not check permission to create symbolic links when unarchiving a symbolic link.</p>\n</li>\n<li>\n<p>SECURITY-2484 / CVE-2021-21688: <code>FilePath#reading(FileVisitor)</code> does not reject any operations, allowing users to have unrestricted read access using certain operations (creating archives, <code>#copyRecursiveTo</code>).</p>\n</li>\n<li>\n<p>SECURITY-2485 / CVE-2021-21689: <code>FilePath#unzip</code> and <code>FilePath#untar</code> were not subject to any access control.</p>\n</li>\n<li>\n<p>SECURITY-2486 / CVE-2021-21690: Agent processes are able to completely bypass file path filtering by wrapping the file operation in an agent file path.</p>\n</li>\n<li>\n<p>SECURITY-2531 / CVE-2021-21691: Creating symbolic links is possible without the <code>symlink</code> permission.</p>\n</li>\n<li>\n<p>SECURITY-2538 / CVE-2021-21692: The operations <code>FilePath#renameTo</code> and <code>FilePath#moveAllChildrenTo</code> only check read permission on the source path.</p>\n</li>\n<li>\n<p>SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is only checked after they&#8217;ve been created.</p>\n</li>\n<li>\n<p>SECURITY-2541 / CVE-2021-21694: <code>FilePath#toURI</code>, <code>FilePath#hasSymlink</code>, <code>FilePath#absolutize</code>, <code>FilePath#isDescendant</code>, and <code>FilePath#get*DiskSpace</code> do not check any permissions.</p>\n</li>\n<li>\n<p>SECURITY-2542 / CVE-2021-21695: <code>FilePath#listFiles</code> lists files outside directories with agent read access when following symbolic links.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>We expect that most of these vulnerabilities have been present since <a href=\"/security/advisory/2014-10-30/\">SECURITY-144 was addressed in the 2014-10-30 security advisory</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>Jenkins 2.319, LTS 2.303.3 addresses these security vulnerabilities.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>SECURITY-2427 / CVE-2021-21685: <code>FilePath#mkdirs</code> checks permission to create parent directories.</p>\n</li>\n<li>\n<p>SECURITY-2444 / CVE-2021-21686: File path filters canonicalize paths, preventing operations from following symbolic links to outside allowed directories.</p>\n</li>\n<li>\n<p>SECURITY-2446 / CVE-2021-21687: <code>FilePath#untar</code> checks permission to create symbolic links when unarchiving a symbolic link.</p>\n</li>\n<li>\n<p>SECURITY-2484 / CVE-2021-21688: <code>FilePath#reading(FileVisitor)</code> correctly rejects operations if they operate on files outside allowed directories.</p>\n</li>\n<li>\n<p>SECURITY-2485 / CVE-2021-21689: <code>FilePath#unzip</code> and <code>FilePath#untar</code> are now subject to access control.</p>\n</li>\n<li>\n<p>SECURITY-2486 / CVE-2021-21690: Agent processes are no longer able to completely bypass file path filtering by wrapping the file operation in an agent file path.</p>\n</li>\n<li>\n<p>SECURITY-2531 / CVE-2021-21691: Creating symbolic links now correctly checks the <code>symlink</code> permission.</p>\n</li>\n<li>\n<p>SECURITY-2538 / CVE-2021-21692: The operations <code>FilePath#renameTo</code> and <code>FilePath#moveAllChildrenTo</code> check both <code>read</code> and <code>delete</code> permissions on the source path.</p>\n</li>\n<li>\n<p>SECURITY-2539 / CVE-2021-21693: When creating temporary files, permission to create files is checked before they are created based on an artificial path.</p>\n</li>\n<li>\n<p>SECURITY-2541 / CVE-2021-21694: <code>FilePath#toURI</code>, <code>FilePath#hasSymlink</code>, <code>FilePath#absolutize</code>, <code>FilePath#isDescendant</code> check <code>stat</code> permission. <code>FilePath#get*DiskSpace</code> methods are no longer allowed to be executed by an agent.</p>\n</li>\n<li>\n<p>SECURITY-2542 / CVE-2021-21695: <code>FilePath#listFiles</code> checks <code>stat</code> permission on files it returns, preventing listing files outside allowed directories.</p>\n</li>\n</ul>\n</div>\n<div class=\"admonitionblock important\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-important\" title=\"Important\"></i>\n</td>\n<td class=\"content\">\nAs some common operations are now newly subject to access control, it is expected that plugins sending commands from agents to the controller may start failing.\nAdditionally, the newly introduced path canonicalization means that instances using a custom builds directory (<a href=\"/doc/book/managing/system-properties/#jenkins-model-jenkins-buildsdir\">Java system property <code>jenkins.model.Jenkins.buildsDir</code></a>) or partitioning <code>JENKINS_HOME</code> using symbolic links may fail access control checks.\nSee <a href=\"/doc/book/security/controller-isolation/agent-to-controller/#file-access-rules\">the documentation</a> for how to customize the configuration in case of problems.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\nIf you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the <a href=\"/redirect/remoting-security-workaround/\">Remoting Security Workaround Plugin</a>.\nIt will prevent all agent-to-controller file access using <code>FilePath</code> APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.\n</td>\n</tr>\n</table>\n</div>"
    },
    {
      "id": "SECURITY-2423",
      "reporter": "Daniel Beck, CloudBees, Inc.",
      "title": "Agent-to-controller access control allowed writing to sensitive directory used by Pipeline: Shared Groovy Libraries Plugin",
      "cve": "CVE-2021-21696",
      "cvss": {
        "severity": "High",
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H"
      },
      "description_adoc": "Jenkins 2.318 and earlier, LTS 2.303.2 and earlier does not limit agent read/write access to the `libs/` directory inside build directories when using the `FilePath` APIs.\nThis directory is used by the Pipeline: Shared Groovy Libraries Plugin to store copies of shared libraries.\n\nThis allows attackers in control of agent processes to replace the code of a trusted library with a modified variant, resulting in unsandboxed code execution in the Jenkins controller process.\n\nJenkins 2.319, LTS 2.303.3 prohibits agent read/write access to the `libs/` directory inside build directories.\n\nNOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].\nIt will prevent all agent-to-controller file access using `FilePath` APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.\n\nIMPORTANT: It is not easily possible to link:/doc/book/security/controller-isolation/agent-to-controller/#file-access-rules[customize the file access rules] to prohibit access to the `libs/` directory specifically, as built-in rules (granting access to `<BUILDDIR>` contents) would take precedence over a custom rule prohibiting access.",
      "plugins": [],
      "components": [],
      "description_html": "<div class=\"paragraph\">\n<p>Jenkins 2.318 and earlier, LTS 2.303.2 and earlier does not limit agent read/write access to the <code>libs/</code> directory inside build directories when using the <code>FilePath</code> APIs.\nThis directory is used by the Pipeline: Shared Groovy Libraries Plugin to store copies of shared libraries.</p>\n</div>\n<div class=\"paragraph\">\n<p>This allows attackers in control of agent processes to replace the code of a trusted library with a modified variant, resulting in unsandboxed code execution in the Jenkins controller process.</p>\n</div>\n<div class=\"paragraph\">\n<p>Jenkins 2.319, LTS 2.303.3 prohibits agent read/write access to the <code>libs/</code> directory inside build directories.</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\nIf you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the <a href=\"/redirect/remoting-security-workaround/\">Remoting Security Workaround Plugin</a>.\nIt will prevent all agent-to-controller file access using <code>FilePath</code> APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock important\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-important\" title=\"Important\"></i>\n</td>\n<td class=\"content\">\nIt is not easily possible to <a href=\"/doc/book/security/controller-isolation/agent-to-controller/#file-access-rules\">customize the file access rules</a> to prohibit access to the <code>libs/</code> directory specifically, as built-in rules (granting access to <code>&lt;BUILDDIR&gt;</code> contents) would take precedence over a custom rule prohibiting access.\n</td>\n</tr>\n</table>\n</div>"
    },
    {
      "id": "SECURITY-2428",
      "reporter": "Daniel Beck, CloudBees, Inc.",
      "title": "Agent-to-controller access control allows reading/writing most content of build directories",
      "cve": "CVE-2021-21697",
      "cvss": {
        "severity": "High",
        "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:L"
      },
      "description_adoc": "Agents are allowed some limited access to files on the Jenkins controller file system.\nThe directories agents are allowed to access in Jenkins 2.318 and earlier, LTS 2.303.2 and earlier include the directories storing build-related information, intended to allow agents to store build-related metadata during build execution.\nAs a consequence, this allows any agent to read and write the contents of any build directory stored in Jenkins with very few restrictions (`build.xml` and some Pipeline-related metadata).\n\nJenkins 2.319, LTS 2.303.3 prevents agents from accessing contents of build directories unless it's for builds currently running on the agent attempting to access the directory.\n\nNOTE: Update https://plugins.jenkins.io/workflow-durable-task-step/[Pipeline: Nodes and Processes] to version 2.40 or newer for Jenkins to associate Pipeline `node` blocks with the agent they're running on for this fix.\n\nNOTE: If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the link:/redirect/remoting-security-workaround/[Remoting Security Workaround Plugin].\nIt will prevent all agent-to-controller file access using `FilePath` APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.",
      "plugins": [],
      "components": [],
      "description_html": "<div class=\"paragraph\">\n<p>Agents are allowed some limited access to files on the Jenkins controller file system.\nThe directories agents are allowed to access in Jenkins 2.318 and earlier, LTS 2.303.2 and earlier include the directories storing build-related information, intended to allow agents to store build-related metadata during build execution.\nAs a consequence, this allows any agent to read and write the contents of any build directory stored in Jenkins with very few restrictions (<code>build.xml</code> and some Pipeline-related metadata).</p>\n</div>\n<div class=\"paragraph\">\n<p>Jenkins 2.319, LTS 2.303.3 prevents agents from accessing contents of build directories unless it&#8217;s for builds currently running on the agent attempting to access the directory.</p>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\nUpdate <a href=\"https://plugins.jenkins.io/workflow-durable-task-step/\">Pipeline: Nodes and Processes</a> to version 2.40 or newer for Jenkins to associate Pipeline <code>node</code> blocks with the agent they&#8217;re running on for this fix.\n</td>\n</tr>\n</table>\n</div>\n<div class=\"admonitionblock note\">\n<table>\n<tr>\n<td class=\"icon\">\n<i class=\"fa icon-note\" title=\"Note\"></i>\n</td>\n<td class=\"content\">\nIf you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the <a href=\"/redirect/remoting-security-workaround/\">Remoting Security Workaround Plugin</a>.\nIt will prevent all agent-to-controller file access using <code>FilePath</code> APIs.\nBecause it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it.\nMake sure to read the plugin documentation before installing it.\n</td>\n</tr>\n</table>\n</div>"
    },
    {
      "id": "SECURITY-2506",
      "reporter": "Daniel Beck, CloudBees, Inc.",
      "title": "Path traversal vulnerability in PLUGIN_NAME allows reading arbitrary files",
      "cve": "CVE-2021-21698",
      "cvss": {
        "severity": "Medium",
        "vector": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N"
      },
      "description_adoc": "PLUGIN_NAME 2.15.0 and earlier does not restrict the name of a file when looking up a subversion key file on the controller from an agent.\n\nThis allows attackers able to control agent processes to read arbitrary files on the Jenkins controller file system.\n\nPLUGIN_NAME 2.15.1 checks for the presence of and prohibits directory separator characters as part of the file name, restricting it to the intended directory.",
      "plugins": [
        {
          "name": "subversion",
          "title": "Subversion",
          "previous": "2.15.0",
          "fixed": "2.15.1"
        }
      ],
      "components": [],
      "description_html": "<div class=\"paragraph\">\n<p>Subversion Plugin 2.15.0 and earlier does not restrict the name of a file when looking up a subversion key file on the controller from an agent.</p>\n</div>\n<div class=\"paragraph\">\n<p>This allows attackers able to control agent processes to read arbitrary files on the Jenkins controller file system.</p>\n</div>\n<div class=\"paragraph\">\n<p>Subversion Plugin 2.15.1 checks for the presence of and prohibits directory separator characters as part of the file name, restricting it to the intended directory.</p>\n</div>"
    }
  ],
  "components": [],
  "index_details_html": null,
  "content_html": null
}