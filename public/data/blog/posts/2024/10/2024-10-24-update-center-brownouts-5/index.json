{
  "id": "2024-10-2024-10-24-update-center-brownouts-5",
  "url": "/blog/2024/10/24/2024-10-24-update-center-brownouts-5/",
  "title": "Brownout on Update Center (updates.jenkins.io):\n 24 and 25 October 2024",
  "date": "2024-10-24",
  "authors": [
    "dduportal"
  ],
  "tags": [
    "jenkins",
    "jenkins-infra",
    "update-center"
  ],
  "summary": "Summary ( TL;DR ) Note: this is a follow up of the 26 and 27 September 24 hours brownout . The service https://updates.jenkins.io will switch its implementation to a new system during 1 day: From Thursday 24 October 2024 from 10:00am UTC until Friday 25 October 2024 10:00am UTC All Jenkins users are impacted but should not see any functional…",
  "opengraph_image": "/images/post-images/2023/01/12/jenkins-newsletter/infrastructure.png",
  "content_html": "<div class=\"sect1\">\n<h2 id=\"summary-tldr\"><a class=\"anchor\" href=\"#summary-tldr\"></a>Summary (<a href=\"https://en.wikipedia.org/wiki/Wikipedia:Too_long;_didn%27t_read\">TL;DR</a>)</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Note: this is a follow up of <a href=\"/blog/2024/09/25/update-center-brownouts-4/\">the 26 and 27 September 24 hours brownout</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>The service <a href=\"https://updates.jenkins.io\" class=\"bare\">https://updates.jenkins.io</a> will switch its implementation to a new system during 1 day:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>From Thursday 24 October 2024 from 10:00am UTC until Friday 25 October 2024 10:00am UTC</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>All Jenkins users are impacted but should not see any functional change.</p>\n</div>\n<div class=\"paragraph\">\n<p>⚠️ Please, check that your organization respects the advertised DNS TTL or you might be stuck in the brownout longer than expected.</p>\n</div>\n<div class=\"paragraph\">\n<p>Under the hood, any HTTP request made to this service will be redirected to a mirror close to user locations during these brownouts.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"what-is-the-update-center\"><a class=\"anchor\" href=\"#what-is-the-update-center\"></a>What is the \"Update Center\"?</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Jenkins <a href=\"https://updates.jenkins.io\">Update Center</a> is a web server at the core of the Jenkins public infrastructure which distributes the plugins, tool installers, and versions index to all Jenkins servers across the world.</p>\n</div>\n<div class=\"paragraph\">\n<p>From the installation wizard to regular plugin updates, if you run Jenkins, then you use this service under the hood.</p>\n</div>\n<div class=\"paragraph\">\n<p>Today, it serves around 50 Tb of data (outbound bandwidth) each month from a single virtual machine on AWS, which costs around $6,000 per month.</p>\n</div>\n<div class=\"paragraph\">\n<p>In order to sustain this service and improve it, the Jenkins infrastructure team has worked relentlessly during the past years to have a new sustainable implementation for this service.</p>\n</div>\n<div class=\"paragraph\">\n<p>The new Update Center implementation features a highly available system that redirects user requests to a download mirror close to their location.\nAdditional information is available in the <a href=\"https://github.com/jenkins-infra/helpdesk/issues/2649\">GitHub issue</a>.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"why-this-fifth-brownout\"><a class=\"anchor\" href=\"#why-this-fifth-brownout\"></a>Why this Fifth \"<a href=\"https://en.wikipedia.org/wiki/Brownout_(electricity)\">Brownout</a>\"?</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Our functional tests and performance tests are meeting our expectations after the initial work and the four brownouts we ran.</p>\n</div>\n<div class=\"paragraph\">\n<p>However the previous (fourth) brownout raised 2 issues:\n- We&#8217;ve seen (and were reported) HTTP/404 errors due to broken links in some HTML pages (not used a lot) and missing endpoints used for healthchecks in <a href=\"https://github.com/jenkins-infra/helpdesk/issues/4311\" class=\"bare\">https://github.com/jenkins-infra/helpdesk/issues/4311</a>\n- We&#8217;ve also seen HTTP/404 errors after 8-9 hours or production usage due to network file share (SMB/CIFS) issues with Apache. The service is self-healing but we are trying to fine tune this: if it fails, then we&#8217;ll have to update the Apache architecture to stop using a network file share. See <a href=\"https://github.com/jenkins-infra/helpdesk/issues/4312\" class=\"bare\">https://github.com/jenkins-infra/helpdesk/issues/4312</a> for details.</p>\n</div>\n<div class=\"paragraph\">\n<p>As such, a fifth brownout serves to verify the above (minor) problems are solved under a production workload.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"how\"><a class=\"anchor\" href=\"#how\"></a>How</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Both current and new Update Centers are updated at the same time and serve the same index.</p>\n</div>\n<div class=\"paragraph\">\n<p>Starting 12 weeks ago, the Jenkins infrastructure has been using the new Update Center (<a href=\"https://azure.updates.jenkins.io\">azure.updates.jenkins.io</a>) with a client-side DNS override (<code>updates.jenkins.io</code> hostname points to this new service).</p>\n</div>\n<div class=\"paragraph\">\n<p>During this brownout, we&#8217;ll simply switch the DNS entry <code>updates.jenkins.io</code> to this new service and watch for the logs and error rate.\nAt the end, we&#8217;ll switch DNS back to the normal service and then analyze metrics and logs to see how the system behaved.</p>\n</div>\n<div class=\"paragraph\">\n<p>We are confident the new system will perform as expected.</p>\n</div>\n<div class=\"paragraph\">\n<p>Please refer to the <a href=\"https://github.com/jenkins-infra/helpdesk/issues/2649\">helpdesk ticket</a> for more information.</p>\n</div>\n</div>\n</div>"
}