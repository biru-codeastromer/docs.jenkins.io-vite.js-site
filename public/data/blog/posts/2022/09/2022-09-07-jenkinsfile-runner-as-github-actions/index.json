{
  "id": "2022-09-2022-09-07-jenkinsfile-runner-as-github-actions",
  "url": "/blog/2022/09/01/2022-09-07-jenkinsfile-runner-as-github-actions/",
  "title": "A near Feature-complete version of Jenkinsfile Runner Actions as GitHub Actions",
  "date": "2022-09-01",
  "authors": [
    "YimingGong"
  ],
  "tags": [
    "gsoc",
    "gsoc2022",
    "jenkinsfile-runner",
    "github-actions"
  ],
  "summary": "== Abstract Jenkinsfile Runner Action for GitHub Actions aims at providing customized environments and useful GitHub Actions for the users. Therefore, users can execute the Jenkins pipeline in the GitHub Actions runners. It enables running Jenkins pipelines in a Function-as-a-Service context. Users can customize their environment by setting up base images, configuring the Jenkins Configuration-as-Code plugin, extending vanilla images orâ€¦",
  "opengraph_image": "/images/gsoc/opengraph.png",
  "content_html": "<div class=\"sect1\">\n<h2 id=\"abstract\"><a class=\"anchor\" href=\"#abstract\"></a>Abstract</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Jenkinsfile Runner Action for GitHub Actions aims at providing customized environments and useful GitHub Actions for the users.\nTherefore, users can execute the Jenkins pipeline in the GitHub Actions runners.\nIt enables running Jenkins pipelines in a Function-as-a-Service context.\nUsers can customize their environment by setting up base images, configuring the Jenkins Configuration-as-Code plugin,\nextending vanilla images or providing initial hooks for the temporary Jenkins controller.\nSeveral examples about how to set up secrets, Jenkins plugins and integrate with other GitHub Actions can be seen below.\nThis project is based on the <a href=\"https://github.com/jenkinsci/jenkinsfile-runner/\">Jenkinsfile runner</a>, which is a command line tool for the Jenkins pipeline execution engine.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"implementation\"><a class=\"anchor\" href=\"#implementation\"></a>Implementation</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Jenkinsfile Runner Action for GitHub Actions help users fetch necessary dependencies,\nand wrap the entrypoint for Jenkinsfile Runner in one GitHub Action.\nUsers can use them in the workflow definitions just like other GitHub Actions.\nBased on this big idea, I developed five GitHub Actions.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"runtime-type-actions\"><a class=\"anchor\" href=\"#runtime-type-actions\"></a>Runtime type actions</h3>\n<div class=\"paragraph\">\n<p>These actions run the pipeline in the GitHub Actions runners host machines directly.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>jfr-setup-action</code> - It's used to set up the Jenkins environment, including but not limited to Jenkins core, plugin installation manager and Jenkinsfile Runner.</p>\n</li>\n<li>\n<p><code>jfr-plugin-installation-action</code> - Users can use it to install extra plugins. <code>jfr-setup-setup</code> needs to be run before.</p>\n</li>\n<li>\n<p><code>jfr-runtime-action</code> - It runs the Jenkins pipeline in the host machine. <code>jfr-setup-setup</code> needs to be run before.</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"container-type-actions\"><a class=\"anchor\" href=\"#container-type-actions\"></a>Container type actions</h3>\n<div class=\"paragraph\">\n<p>These actions run the pipeline in the customized container.</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><code>jfr-container-action</code> - It runs the Jenkins pipeline in the declared container.\nAs the prebuilt container is declared in advance, it can integrate with other GitHub Actions theoretically.\nIt's based on the idea of <a href=\"https://docs.github.com/en/actions/using-jobs/running-jobs-in-a-container\">Running jobs in a container</a>.</p>\n</li>\n<li>\n<p><code>jfr-static-image-action</code> - It runs the Jenkins pipeline in the runtime built container.\nIt doesn't need to declare the container in advance so users cannot use other GitHub Actions except using <code>actions/checkout</code> to set up the workspace.\nBut the users can override the base image by providing the docker image URL.\nFor instance, if users want to combine the Jenkins environment with nodejs environment, they can use <code>node:18.3.0</code> as input.\nIt's based on the idea of <a href=\"https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action#introduction/\">GitHub Docker container action</a>.</p>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"phase-1\"><a class=\"anchor\" href=\"#phase-1\"></a>Phase 1</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>When I started to write code based on my previous proposal, I found my implementation is different from the expectation of the maintainer and the mentors.\nWhat I wanted to do is make Jenkinsfile runner capable of generating necessary configurations for users.\nSo they can use these configuration files to complete their Jenkinsfile runner actions.\nHowever, this method will couple the configuration generation step with Jenkinsfile runner which is a command line tool for Jenkins pipeline execution engine.\nThe maintainer and the mentors proposed to make several useful GitHub Actions instead of coupling this unnecessary logic into Jenkinsfile runner.\nTherefore, I changed my project plan based on their advice and worked on developing the GitHub Actions for Jenkinsfile runner.</p>\n</div>\n<div class=\"paragraph\">\n<p>In this stage, I developed <code>jfr-container-action</code> and <code>jfr-static-image-action</code>, which run in the customized containers.\nIts main advantage is that most dependencies are prepared in advance in the container.\nI also made several useful options in Jenkinsfile runner available in our GitHub actions such as the initial hook option.\nTo make users get started in our actions quickly, I refactored the documentation several times,\nand created several useful examples.\nIt is worth noting that my examples aim at applying Jenkins pipeline in GitHub Actions runner which is a FaaS context.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"phase-2\"><a class=\"anchor\" href=\"#phase-2\"></a>Phase 2</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>In the second phase, I found current actions can only be supported by GitHub Actions Linux runner.\nThen I decided to develop the runtime type actions so they can run in all kinds of GitHub Actions runners.\nIts advantages are obvious.\nThe runtime type actions are <code>jfr-setup-action</code>, <code>jfr-plugin-installation-action</code> and <code>jfr-runtime-action</code>.\nThese actions will download all the dependencies at the runtime compared to container type actions' behavior.\nIts main disadvantage is the possibility of suffering from a download center outage.</p>\n</div>\n<div class=\"paragraph\">\n<p>What's more, I kept developing examples for the actions and updated the documentation.\nAs the project and documentation grow infinitely, I decided to split my project into several subprojects,\nand host the documentation including the user guide and developer guide on the GitHub Pages.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"deliverables\"><a class=\"anchor\" href=\"#deliverables\"></a>Deliverables</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>I write a <a href=\"https://jenkinsci.github.io/jfr-action-doc\">central documentation page</a> above the interface, basic usage, advanced usage, demos and developer guide for these Jenkinsfile-runner GitHub actions.\nIf you feel confused about the definitions or examples, you can check the documentation page mentioned above.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"how-to-use-jfr-container-action\"><a class=\"anchor\" href=\"#how-to-use-jfr-container-action\"></a>How to use jfr-container-action</h3>\n<div class=\"paragraph\">\n<p>The user needs to declare the image usage of <code>ghcr.io/jenkinsci/jenkinsfile-runner:master</code> at the start of the job.\nThen the user can call this action by using <code>jenkinsci/jfr-container-action@master</code>.\nBecause the runner declares the container environment at the start,\nother GitHub Actions can also run with <code>jfr-container-action</code> theoretically.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-yaml\" data-lang=\"yaml\">name: CI\non: [push]\njobs:\n  jfr-container-action-pipeline:\n    runs-on: ubuntu-latest\n    container:\n      image: ghcr.io/jenkinsci/jenkinsfile-runner:master\n    steps:\n      - uses: actions/checkout@v2\n      - name: Jenkins pipeline in the container\n        uses:\n          jenkinsci/jfr-container-action@master\n        with:\n          command: run\n          jenkinsfile: Jenkinsfile\n          pluginstxt: plugins.txt\n          jcasc: jcasc.yml</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"how-to-use-jfr-static-image-action\"><a class=\"anchor\" href=\"#how-to-use-jfr-static-image-action\"></a>How to use jfr-static-image-action</h3>\n<div class=\"paragraph\">\n<p><code>jfr-static-image-action</code> can also run the pipeline in the container.\nBut the users don't need to declare the container by themselves like <code>jfr-container-action</code>.\nInstead, <code>jfr-static-image-action</code> wraps the preparation and invocation of a customized container.\nTherefore, the users cannot use other GitHub Actions except using <code>actions/checkout</code> to set up the workspace.\nThe users can call this action by using <code>jenkinsci/jfr-static-image-action@master</code>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-yaml\" data-lang=\"yaml\">name: CI\non: [push]\njobs:\n  jfr-static-image-action-pipeline:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Jenkins pipeline in the container\n        uses:\n          jenkinsci/jfr-static-image-action@master\n        with:\n          command: run\n          jenkinsfile: Jenkinsfile\n          pluginstxt: plugins.txt\n          jcasc: jcasc.yml</code></pre>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"how-to-use-jfr-runtime-action-with-other-supporting-runtime-type-actions\"><a class=\"anchor\" href=\"#how-to-use-jfr-runtime-action-with-other-supporting-runtime-type-actions\"></a>How to use jfr-runtime-action with other supporting runtime type actions</h3>\n<div class=\"paragraph\">\n<p><code>jfr-runtime-action</code> will run the pipeline in the host machine directly.\nThe users need to use <code>jfr-setup-action</code> in advance.\nIf the users want to install extra plugins, they can use <code>jfr-plugin-installation-action</code>.\nThe advantage of <code>jfr-runtime-action</code> is that it can run in all kinds of runners provided by GitHub Actions.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-yaml\" data-lang=\"yaml\">name: CI\non: [push]\njobs:\n  jfr-runtime-action-pipeline:\n    strategy:\n      matrix:\n        os: [ ubuntu-latest, macOS-latest, windows-latest ]\n    runs-on: ${{matrix.os}}\n    name: jfr-runtime-action-pipeline\n    steps:\n      - uses: actions/checkout@v2\n      - name : Setup Jenkins\n        uses:\n          jenkinsci/jfr-runtime-action@master\n      - name: Jenkins plugins download\n        uses:\n          jenkinsci/jfr-plugin-installation-action@master\n        with:\n          pluginstxt: plugins.txt\n      - name: Run Jenkins pipeline\n        uses:\n          jenkinsci/jfr-runtime-action@master\n        with:\n          command: run\n          jenkinsfile: Jenkinsfile</code></pre>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"reflection\"><a class=\"anchor\" href=\"#reflection\"></a>Reflection</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The most valuable lesson I learned in GSoC is not about how to write code.\nIt's about the method of communicating with other people in the Jenkins community.\nWhen I was new in the Jenkins community, I kept making assumptions when I communicate with my mentors and project maintainers.\nTherefore, it's easy for them to misunderstand my idea.\nThe best way of communication in Jenkins open source community is over-explanation.\nSometimes, people who lack background information cannot understand your ideas about a specific topic.\nTherefore, providing some extra explanations or descriptions is necessary.</p>\n</div>\n<div class=\"paragraph\">\n<p>The second lesson I learned is still about communication.\nWhen you feel confused about the words under a specific context, it's better to ask the contributors or your mentors directly instead of spending plenty of time by yourself.\nThe people in Jenkins open source community are always willing to give you the answers.\nFurthermore, if you have obstacles or milestones when developing the tools or plugins, it's still necessary to ask the community developers first instead of making the decisions arbitrarily.</p>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"project-links\"><a class=\"anchor\" href=\"#project-links\"></a>Project links</h2>\n<div class=\"sectionbody\">\n<div class=\"ulist\">\n<ul>\n<li>\n<p><a href=\"https://jenkinsci.github.io/jfr-action-doc\">Central documentation page</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/jfr-setup-action\">jfr-setup-action repository</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/jfr-plugin-installation-action\">jfr-plugin-installation-action repository</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/jfr-runtime-action\">jfr-runtime-action repository</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/jfr-container-action\">jfr-container-action repository</a></p>\n</li>\n<li>\n<p><a href=\"https://github.com/jenkinsci/jfr-static-image-action\">jfr-static-image-action repository</a></p>\n</li>\n</ul>\n</div>\n</div>\n</div>"
}