{
  "id": "2023-08-2023-08-30-a-glimpse-of-the-future",
  "url": "/blog/2023/08/30/2023-08-30-a-glimpse-of-the-future/",
  "title": "A glimpse of the future",
  "date": "2023-08-30",
  "authors": [
    "gounthar"
  ],
  "tags": [
    "jenkins",
    "jdk21",
    "risc-v"
  ],
  "summary": "You've all seen it before: the bitter sting of botched predictions.",
  "opengraph_image": "/images/post-images/2023/08/30/2023-08-30-a-glimpse-of-the-future/a-glimpse-of-the-future.png",
  "content_html": "<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2023/08/30/2023-08-30-a-glimpse-of-the-future/image2.png\" alt=\"image\" width=\"839\"></span></p>\n</div>\n<div class=\"paragraph\">\n<p>You've all seen it before: the bitter sting of botched predictions.\nFlying cars, nuclear ovens in the kitchen, killer robot dogs, and lunar living - all expected to be part of our daily lives by now.\nWell, some of these wild dreams did come to pass, but I'm not about to roll the dice and predict what our world will look like 50 years hence.\nInstead, let me paint a picture of Jenkins' future up until October 2024.</p>\n</div>\n<div class=\"paragraph\">\n<p>Why am I being so specific about this end date, you ask?\nIt's because I want to highlight two major projects that Jenkins might tackle before the leaves start to fall next year.</p>\n</div>\n<div class=\"paragraph\">\n<p>One of these projects is the potential leap to JDK21, and we've got a proposed roadmap for that.\nJenkins will stop supporting JDK 11 in October 2024 when many Java providers (Eclipse Temurin, OpenJDK, …&#8203;) stop supporting Java 11.\nThis transition is one of the more significant moves Jenkins might be considering in the coming months.</p>\n</div>\n<div class=\"paragraph\">\n<p>The next project doesn't have a roadmap within Jenkins yet, but the progress is promising, and it's intertwined with the first project like two vines on a trellis.\nAs some of you may know, I've got a fondness for CPU architectures that were once seen as outlandish or still raise a few eyebrows.\nI'm referring to ARM and RISC-V, of course.</p>\n</div>\n<div class=\"paragraph\">\n<p>ARM is making strides, finding its way into everything from laptops to servers.\nSo, my personal campaign to see ARM recognized as a first-class citizen has been successful.</p>\n</div>\n<div class=\"paragraph\">\n<p>Now, I'm turning my attention to RISC-V - my next personal endeavor and hobby.\nWhile it's not a fresh face in the CPU crowd, it's currently experiencing a notable uptick in popularity.\nThe emergence of numerous single-board computers, workstations, and servers reminds me of the early days of ARM, but amplified.\nI've touched on this before in one of my <a href=\"/blog/2023/03/10/miniJen-and-RISC-V/#the-risc-v-quest\">blog posts</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>Let’s explore how JDK21, Jenkins, and RISC-V might be connected, at least in the maze of my musings.</p>\n</div>\n<div class=\"sect1\">\n<h2 id=\"java-version-planning-for-jenkins\"><a class=\"anchor\" href=\"#java-version-planning-for-jenkins\"></a>Java Version Planning for Jenkins</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The ink's barely dry on the plans for which versions of the JDK the Jenkins project will support this year and the next.\nWhat I'm about to spill is just a snippet from a proposal whipped up by author:markewaite[Mark Waite].\nFor now, it's about as definitive as a weather forecast.</p>\n</div>\n<div class=\"paragraph\">\n<p>There'll be more detailed blog posts down the line when the final decision is made and the roadmap is as clear as a bell.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"java-11\"><a class=\"anchor\" href=\"#java-11\"></a>Java 11:</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Java 11 OpenJDK's public support ends in late 2024.</p>\n</li>\n<li>\n<p>Eclipse Temurin, Red Hat, and Microsoft will support Java 11 through October 2024.</p>\n</li>\n<li>\n<p>Oracle extends support until October 2026.</p>\n</li>\n<li>\n<p>Amazon Corretto supports Java 11 until September 2027.</p>\n</li>\n<li>\n<p>Proposal: End-of-life for Java 11 in Jenkins is suggested for October 31, 2024.</p>\n</li>\n<li>\n<p>Jenkins LTS support for Java 11 will end with the August 7, 2024 release.</p>\n</li>\n<li>\n<p>Java 21 will become the required baseline starting with the September 4, 2024 LTS release.</p>\n</li>\n<li>\n<p>Admin monitors announcing Java 11's end of life will be enabled in Jenkins weekly releases by October 3, 2023 and in the December 13, 2023 LTS release.</p>\n</li>\n</ul>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"java-17\"><a class=\"anchor\" href=\"#java-17\"></a>Java 17:</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Java 17 adoption is increasing in Jenkins.\nThe Jenkins documentation now recommends Java 17 in the installation guides and in the tutorials.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2023/08/30/2023-08-30-a-glimpse-of-the-future/image3.png\" alt=\"Java adoption rates based on Java version.\" width=\"839\"></span></p>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"java-21\"><a class=\"anchor\" href=\"#java-21\"></a>Java 21:</h3>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>Java 21 releases on September 19, 2023.</p>\n</li>\n<li>\n<p>Oracle, Eclipse Temurin, Red Hat, and others plan to support Java 21 as a long term support release.</p>\n</li>\n<li>\n<p>Proposal: Jenkins aims to support Java 21 in weekly releases by the end of October 2023.</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Are we confident Jenkins will be running on top of JDK 21 next October?<br>\nI guess so. Thanks to the work of Stéphane Merle, JDK21 is already available at <a href=\"https://ci.jenkins.io\">https://ci.jenkins.io</a> to build plugins.\nYou just have to add one line to your Jenkinsfile, and your plugin will be tested on JDK21.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-groovy\" data-lang=\"groovy\">configurations: [\n[platform: 'linux', jdk: '17'],\n[platform: 'linux', jdk: '21'],\n[platform: 'windows', jdk: '11']\n]</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Furthermore, thanks to the work of the community (and particularly author:basil[Basil Crow]), Jenkins <code>2.419</code> and <code>2.420</code> no longer require the <code>--enable-future-java</code> flag for JDK 21 beta.\nJenkins <code>2.418</code> and prior require the flag for Java 21 beta.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">$ java -version\nopenjdk version \"21-beta\" 2023-09-19\nOpenJDK Runtime Environment Temurin-21+34-202308082331 (build 21-beta+34-202308082331)\nOpenJDK 64-Bit Server VM Temurin-21+34-202308082331 (build 21-beta+34-202308082331, mixed mode, sharing)\n\n$ java -jar jenkins-2.417.war\nRunning with Java 21 from /opt/jdk-21, which is not yet fully supported.\nRun the command again with the --enable-future-java flag to enable preview support for future Java versions.\nSupported Java versions are: [11, 17]\nSee link:https://jenkins.io/redirect/java-support/ for more information.\n\n$ java -jar jenkins-2.419.war\nRunning from: /home/mwaite/bugs/jenkins-2.419.war\nwebroot: /home/mwaite/.jenkins/war\n2023-08-24 15:42:32.857+0000 [id=1]     INFO    winstone.Logger#logInternal: Beginning extraction from war file`</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>I also heard from Basil Crow during the <a href=\"https://community.jenkins.io/t/governance-meeting-august-21-2023/9142\">latest Governance board meeting</a> that the <a href=\"/doc/developer/plugin-development/dependency-management/#jenkins-core-bom\">Jenkins BOM</a> had already run with JDK21; that’s good news.\nWe will have to stay alert because of things that won’t migrate easily (think of Groovy for example), but if it’s too easy, it’s no fun, right?</p>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"jenkins-and-risc-v\"><a class=\"anchor\" href=\"#jenkins-and-risc-v\"></a>Jenkins and RISC-V</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The Jenkins project is already churning out <code>aarch64</code> (64-bit ARM) Docker images for both the controller and agents.\nOn top of that, we're putting <code>aarch64</code> through its paces with regular testing, and some parts of the Jenkins infrastructure are already humming along on <code>aarch64</code> hardware.<br>\nWe can't say the same for <code>RISC-V</code>, and for good reason.\n<code>RISC-V</code> isn't a supported CPU architecture for Jenkins, it hasn't been put to the test, Docker isn't officially on board with this architecture yet (even if Kubernetes is <a href=\"https://twitter.com/hipeac/status/1687344636795252737?s=20\">already on the bandwagon</a>), and the Jenkins project doesn't own a single RISC-V machine.</p>\n</div>\n<div class=\"paragraph\">\n<p>A few months back, I whipped up a <a href=\"/blog/2023/03/10/miniJen-and-RISC-V/#the-risc-v-quest\">Jenkins agent for RISC-V</a>.\nSadly, the machine I had at my disposal wasn't up to the task of hosting a Jenkins controller.\nAt that time, I was using a nightly build of JDK19 by Temurin.</p>\n</div>\n<div class=\"paragraph\">\n<p>These days, I've got another RISC-V machine that's got more cores and more memory than the last one, and it meets the Jenkins recommendations, which are:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>4 GB+ of RAM</p>\n</li>\n<li>\n<p>50 GB+ of drive space</p>\n</li>\n</ul>\n</div>\n<div class=\"paragraph\">\n<p>Here I'm wielding the StarFive VisionFive2, which boasts 8GB of RAM, 4 RISCV64 cores clocking up to 1.5GHz, and for now, a 128GB SDCard.\nI'll swap it out for an NVMe disk when I get around to it.\nIt's built on the <a href=\"https://www.starfivetech.com/en/site/soc\">JH7110</a> from StarFive.\nWe're seeing this SoC pop up on SBCs more and more these days (Star64, and so on).</p>\n</div>\n<div class=\"paragraph\">\n<p>Since the machine is (on paper) up to the task of running Jenkins, we should give it a whirl, right?<br>\nI loaded a snapshot version of Debian onto the board after giving the firmware a tune-up, and away we went.</p>\n</div>\n<div class=\"sect2\">\n<h3 id=\"risc-v-and-jdk\"><a class=\"anchor\" href=\"#risc-v-and-jdk\"></a>RISC-V and JDK</h3>\n<div class=\"sect3\">\n<h4 id=\"jdk17\"><a class=\"anchor\" href=\"#jdk17\"></a>JDK17</h4>\n<div class=\"paragraph\">\n<p>The logical first step would be to install a version of the JDK, then follow the official documentation to get Jenkins up and running on Debian, right?</p>\n</div>\n<div class=\"paragraph\">\n<p>I've already been burned by the default JDK on RISC-V with Debian, which turns out to be a <a href=\"/blog/2023/03/10/miniJen-and-RISC-V/#zero-vm\">Zero VM</a>.<br>\nIf I were to kick things off with the default JDK, I reckon its performance would leave me so frustrated, I wouldn't bother going any further.<br>\nYou're not buying it?\nAlright, I see how it is.\nLet's not install Jenkins the old-fashioned way then, let's give it a whirl on the command line after installing the default JDK.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo apt install openjdk-17-jdk-headless\n\njava -version\nopenjdk version \"17.0.5\" 2022-10-18\nOpenJDK Runtime Environment (build 17.0.5+8-Debian-2)\nOpenJDK 64-Bit Zero VM (build 17.0.5+8-Debian-2, interpreted mode)</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Yes, we’re using a Zero VM.\nNow onto the Jenkins war download.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">curl -L -o /tmp/jenkins.war link:https://updates.jenkins.io/latest/jenkins.war</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Let’s launch Jenkins on the command line:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">java -jar /tmp/jenkins.war\n\nRunning from: /tmp/jenkins.war\n\nwebroot: /home/user/.jenkins/war\n\n2023-08-06 12:31:15.432+0000 [id=1] INFO winstone.Logger#logInternal: Beginning extraction from war file</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Let's say I let it run for a good while, and nothing else happened.<br>\nA Zero VM is about as useful for running a server as a chocolate teapot.<br>\nLet's switch gears and go with something that's got a bit more pep in its step.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"jdk21\"><a class=\"anchor\" href=\"#jdk21\"></a>JDK21</h4>\n<div class=\"paragraph\">\n<p>As I'm penning this article, there's no official JDK21 release we can snag from the <a href=\"https://adoptium.net/temurin/releases/\">Eclipse Temurin Latest Releases</a> page.<br>\nWe'll have to scrounge up a nightly build from the Adoptium <a href=\"https://github.com/adoptium/temurin21-binaries/releases\">Temurin 21 binaries repo.</a><br>\nRISC-V binaries aren't exactly churned out daily, so you might have to do a bit of digging to find a release with RISC-V binaries.<br>\nAt the time of writing this blog post, the latest available is release <a href=\"https://github.com/adoptium/temurin21-binaries/releases/tag/jdk21-2023-08-08-20-16-beta\">jdk21-2023-08-08-20-16-beta</a>.<br>\nIn this release, there are several RISC-V binaries up for grabs, but we don't need static libs or a debug image, so we'll opt for <a href=\"https://github.com/adoptium/temurin21-binaries/releases/download/jdk21-2023-08-08-20-16-beta/OpenJDK21U-jdk_riscv64_linux_hotspot_2023-08-08-20-16.tar.gz\">OpenJDK21U-jdk_riscv64_linux_hotspot_2023-08-08-20-16.tar.gz</a>.</p>\n</div>\n<div class=\"paragraph\">\n<p>Let's reel in the JDK21 binaries:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">curl -L -O link:https://github.com/adoptium/temurin21-binaries/releases/download/jdk21-2023-08-08-20-16-beta/OpenJDK21U-jdk_riscv64_linux_hotspot_2023-08-08-20-16.tar.gz</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Now that we have them, let’s install them on the machine.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo mkdir /opt/jdk21\nsudo tar -xzf OpenJDK21U-jdk_riscv64_linux_hotspot_*.tar.gz -C /opt/jdk21 --strip-components=1</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Once it’s installed, let’s inform the system about this new set of java binaries:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo update-alternatives --install /usr/bin/java java /opt/jdk21/bin/java 1\nsudo update-alternatives --install /usr/bin/javac javac /opt/jdk21/bin/javac 1\nsudo update-alternatives --install /usr/bin/javadoc javadoc /opt/jdk21/bin/javadoc 1</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>These commands create alternatives for the java, javac, and javadoc commands and associate them with the respective binaries in the JDK 21 installation.</p>\n</div>\n<div class=\"paragraph\">\n<p>After installing the alternatives, you need to select the default one.\nRun the following command and choose the number corresponding to the JDK 21 alternative in the presented menu:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo update-alternatives --config java</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Repeat this for javac and javadoc:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo update-alternatives --config javac\nsudo update-alternatives --config javadoc</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Verify the Default Java Version: After configuring the alternatives, you can verify that JDK 21 is the default Java version by running:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">java -version</code></pre>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect2\">\n<h3 id=\"jenkins-and-jdk21\"><a class=\"anchor\" href=\"#jenkins-and-jdk21\"></a>Jenkins and JDK21</h3>\n<div class=\"sect3\">\n<h4 id=\"on-the-command-line\"><a class=\"anchor\" href=\"#on-the-command-line\"></a>On the command line</h4>\n<div class=\"paragraph\">\n<p>Let’s try to launch Jenkins with JDK21 now, and see if it gets any better than with JDK17:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">java -jar /tmp/jenkins.war +\nRunning from: /tmp/jenkins.war\nwebroot: /home/user/.jenkins/war\n2023-08-24 08:35:11.202+0000 [id=1] INFO winstone.Logger#logInternal: Beginning extraction from war file\n2023-08-24 08:35:17.635+0000 [id=1] WARNING o.e.j.s.handler.ContextHandler#setContextPath: Empty contextPath\n2023-08-24 08:35:17.947+0000 [id=1] INFO org.eclipse.jetty.server.Server#doStart: jetty-10.0.15; built: 2023-04-11T17:25:14.480Z; git: 68017dbd00236bb7e187330d7585a059610f661d; jvm 21-beta+34-202308081713\n2023-08-24 08:35:19.288+0000 [id=1] INFO o.e.j.w.StandardDescriptorProcessor#visitServlet: NO JSP Support for /, did not find org.eclipse.jetty.jsp.JettyJspServlet\n2023-08-24 08:35:19.521+0000 [id=1] INFO o.e.j.s.s.DefaultSessionIdManager#doStart: Session workerName=node0\n2023-08-24 08:35:22.058+0000 [id=1] INFO hudson.WebAppMain#contextInitialized: Jenkins home directory: /home/user/.jenkins found at: $user.home/.jenkins\n2023-08-24 08:35:22.647+0000 [id=1] INFO o.e.j.s.handler.ContextHandler#doStart: Started w.@2a9bc08f\\{Jenkins v2.420,/,file:///home/user/.jenkins/war/,AVAILABLE}\\{/home/user/.jenkins/war}\n2023-08-24 08:35:22.698+0000 [id=1] INFO o.e.j.server.AbstractConnector#doStart: Started ServerConnector@43599640\\{HTTP/1.1, (http/1.1)}\\{0.0.0.0:8080}\n2023-08-24 08:35:22.743+0000 [id=1] INFO org.eclipse.jetty.server.Server#doStart: Started Server@b83a9be\\{STARTING}[10.0.15,sto=0] @14031ms\n2023-08-24 08:35:22.746+0000 [id=35] INFO winstone.Logger#logInternal: Winstone Servlet Engine running: controlPort=disabled\n2023-08-24 08:35:23.763+0000 [id=42] INFO jenkins.InitReactorRunner$1#onAttained: Started initialization\n2023-08-24 08:35:23.820+0000 [id=40] INFO jenkins.InitReactorRunner$1#onAttained: Listed all plugins\n2023-08-24 08:35:28.157+0000 [id=40] INFO jenkins.InitReactorRunner$1#onAttained: Prepared all plugins\n2023-08-24 08:35:28.180+0000 [id=40] INFO jenkins.InitReactorRunner$1#onAttained: Started all plugins\n2023-08-24 08:35:28.204+0000 [id=40] INFO jenkins.InitReactorRunner$1#onAttained: Augmented all extensions\n2023-08-24 08:35:29.182+0000 [id=46] INFO jenkins.InitReactorRunner$1#onAttained: System config loaded\n2023-08-24 08:35:29.185+0000 [id=40] INFO jenkins.InitReactorRunner$1#onAttained: System config adapted\n2023-08-24 08:35:29.187+0000 [id=43] INFO jenkins.InitReactorRunner$1#onAttained: Loaded all jobs\n2023-08-24 08:35:29.194+0000 [id=43] INFO jenkins.InitReactorRunner$1#onAttained: Configuration for all jobs updated\n2023-08-24 08:35:29.366+0000 [id=60] INFO hudson.util.Retrier#start: Attempt #1 to do the action check updates server\n2023-08-24 08:35:31.242+0000 [id=45] INFO jenkins.install.SetupWizard#init:\n*************************************************************\n*************************************************************\n*************************************************************\nJenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n2c4d91ba22d24f639a59ad50e6d82686\nThis may also be found at: /home/user/.jenkins/secrets/initialAdminPassword\n*************************************************************\n*************************************************************\n*************************************************************</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Jenkins coughed up this log a few seconds after I fired off the command, so it looks like we're in business.<br>\nNotice anything odd?\nShouldn't Jenkins give us a heads-up that it's not meant to run with JDK21?\nAren't JDK17 and JDK11 the only ones getting the official nod?<br>\nUp until a few weeks ago, that was the score…&#8203;\nAnd it'll stay that way for the LTS versions until next October.\nAt the start of August 2023, this <a href=\"https://github.com/jenkinsci/jenkins/pull/8365\">PR</a> got the green light, and since then, there's no need to add the <code>--enable-future-java</code> flag to give JDK21 versions the go-ahead.</p>\n</div>\n<div class=\"paragraph\">\n<p>Let's take the current LTS for a spin:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">curl -L -o /tmp/jenkins.war link:https://get.jenkins.io/war-stable/latest/jenkins.war\njava -jar /tmp/jenkins.war\nRunning with Java 21 from /opt/jdk21, which is not yet fully supported.\nRun the command again with the --enable-future-java flag to enable preview support for future Java versions.\nSupported Java versions are: [11, 17]\nSee link:https://jenkins.io/redirect/java-support/ for more information.</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>As you can see, the current LTS does not support JDK 21 yet.</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"jenkins-standard-package-installation\"><a class=\"anchor\" href=\"#jenkins-standard-package-installation\"></a>Jenkins standard package installation</h4>\n<div class=\"paragraph\">\n<p>As we’re using Debian, let’s go with the <a href=\"/doc/book/installing/linux/#weekly-release\">standard installation of the weekly release</a> now.<br>\nUnfortunately, we get an error when installing the Jenkins package the official way.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">Job for jenkins.service failed because the control process exited with error code.\nSee \"systemctl status jenkins.service\" and \"journalctl -xeu jenkins.service\" for details.</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>These commands don’t say much to help with understanding what the problem is.<br>\nLet’s try another way:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">/usr/bin/jenkins\njenkins: invalid Java version: openjdk version \"21-beta\" 2023-09-19\nOpenJDK Runtime Environment Temurin-21+34-202308081713 (build 21-beta+34-202308081713)\nOpenJDK 64-Bit Server VM Temurin-21+34-202308081713 (build 21-beta+34-202308081713, mixed mode, sharing)</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Now it's clear as day: we've installed a JDK21 version that plays nice with the WAR file, but the scripts tied to <code>systemd</code> aren't up to speed with this JDK version yet.<br>\nThey're still checking if we're using JDK11, 17 or 21, but they're not ready for prime time, hence the failure.<br>\nSo, how do we fix this mess?</p>\n</div>\n</div>\n<div class=\"sect3\">\n<h4 id=\"tweaking-the-package-installation\"><a class=\"anchor\" href=\"#tweaking-the-package-installation\"></a>Tweaking the package installation</h4>\n<div class=\"paragraph\">\n<p>The <a href=\"/doc/book/system-administration/systemd-services/#overriding-service-configurations\">official documentation</a> tells us we can override systemd service configurations thanks to</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo systemctl edit jenkins.</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>This gives us something like:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">### Editing /etc/systemd/system/jenkins.service.d/override.conf\n### Anything between here and the comment below will become the new contents of the file\n\n[Service]\nEnvironment=\"JAVA_OPTS=-Djava.awt.headless=true -Xmx1024m\"\nEnvironment=\"JENKINS_OPTS=--enable-future-java\"</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>I have just added the last line in the hope of getting Jenkins to start.</p>\n</div>\n<div class=\"paragraph\">\n<p><code>sudo systemctl daemon-reload</code> and <code>sudo systemctl start jenkins</code> should now be enough to get Jenkins started.</p>\n</div>\n<div class=\"paragraph\">\n<p>Yes, we’re almost good to go:<br></p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">sudo systemctl status jenkins\n● jenkins.service - Jenkins Continuous Integration Server\nLoaded: loaded (/lib/systemd/system/jenkins.service; enabled; preset: enabled)\nDrop-In: /etc/systemd/system/jenkins.service.d\n└─override.conf\nActive: activating (start) since Thu 2023-08-24 09:28:34 UTC; 1min 2s ago\nMain PID: 7138 (java)\nCPU: 2min 32.701s\nCGroup: /system.slice/jenkins.service\n└─7138 /usr/bin/java -Djava.awt.headless=true -Xmx1024m -jar /usr/share/java/jenkins.war --webroot=/var/cache/jenkins/war --httpPort=8></code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Why almost?\nWe've still got a couple of hitches.\nThe first one is the timeout.\nThese RISC-V machines don't have an optimized kernel yet, so a lot of things are slower than molasses in January.\nToo slow.<br>\nWe'd best give Jenkins a bit more time to get its act together, just to be on the safe side.<br>\nLet's bump up the timeout.\nLike before, we'll tweak the configuration: courtesy of <code>sudo systemctl edit jenkins</code>.</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">### Editing /etc/systemd/system/jenkins.service.d/override.conf\n### Anything between here and the comment below will become the new contents of the file\n\n[Service]\nEnvironment=\"JAVA_OPTS=-Djava.awt.headless=true -Xmx1024m\"\nTimeoutStartSec=390\n\n### Lines below this comment will be discarded</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>You may have spotted I removed <code>Environment=\"JENKINS_OPTS=--enable-future-java\"</code> from the settings.\nWe're running the last weekly release of Jenkins that can handle JDK21, so why should we keep that?<br>\nWe've got another fly in the ointment: the existing jenkins script in <code>/usr/bin/jenkins</code> is pulling a rabbit out of its hat with <code>sed</code>, trying to pin down a valid release.\nUnfortunately, our Java binary spits out something like “<code>21-beta</code>”.\nThe script then trips up on validation, and in the end, throws a tantrum and refuses to start Jenkins.<br>\nOur workaround (while we twiddle our thumbs waiting for <a href=\"https://github.com/jenkinsci/packaging/pull/429\">this PR</a> to build the next package) is to tweak this file.\nChange line 40 so it reads:</p>\n</div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-shell\" data-lang=\"shell\">awk -F '\"' '/version/ \\{print $2}' | awk -F '.' '\\{match($1, /^[0-9]+/); print substr($1, RSTART, RLENGTH)}')</code></pre>\n</div>\n</div>\n<div class=\"paragraph\">\n<p>Once you've done that, fire off <code>sudo systemctl daemon-reload</code> and <code>sudo systemctl restart jenkins</code> and voilà, you've got a Jenkins instance running on JDK21 on a RISC-V machine.<br>\nFor those of you still hanging in there, yes, there's a quicker workaround…&#8203;<br>\nJust stick the <code>Environment=\"JENKINS_OPTS=--enable-future-java\"</code> line back in the <code>override.conf</code> file, and you'll have a Jenkins instance up and running with JDK21 faster than you can say \"compile\".</p>\n</div>\n<div class=\"paragraph\">\n<p><span class=\"image\"><img src=\"/images/post-images/2023/08/30/2023-08-30-a-glimpse-of-the-future/image1.png\" alt=\"image\" width=\"839\"></span></p>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"sect1\">\n<h2 id=\"whats-next\"><a class=\"anchor\" href=\"#whats-next\"></a>What’s next?</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>We've now got a fresh-off-the-press Jenkins instance humming along thanks to a nightly build of the JDK21 by Temurin.<br>\nThat's all well and good, but how do we install newer versions of the JDK when they roll off the assembly line?<br>\nOne of these days, we'll have regular JDK21 releases available straight from the package manager, but until that day comes, how are we supposed to update our installed version?</p>\n</div>\n<div class=\"paragraph\">\n<p>Well, I don't have a silver bullet, but how about using Jenkins?<br>\nI've whipped up a nifty little <a href=\"https://github.com/gounthar/jenkins-temurin-riscv/blob/main/Jenkinsfile-21\">Jenkinsfile</a> that checks every day at 2:30 AM UTC if Temurin has pushed out a new nightly build for RISC-V.<br>\nIf it strikes gold, it installs it into <code>/home/jenkins/jdk-21</code>.<br>\nIt's not exactly a masterpiece, since the version we're using is in <code>/opt/jdk21</code>, but we could tweak it to shoot us an email when it finds something.<br>\nWe'd then have to put Jenkins on ice, shuffle the contents of <code>/home/jenkins/jdk-21</code> over to <code>/opt/jdk21</code>, and then wake Jenkins back up.</p>\n</div>\n<div class=\"paragraph\">\n<p>If you're itching to give it a whirl, just whip up a <a href=\"/doc/book/pipeline/getting-started/#defining-a-pipeline-in-scm\">new pipeline from source control</a> and point it at the <a href=\"https://github.com/gounthar/jenkins-temurin-riscv.git\">repo I mentioned earlier</a>.<br>\nI'll be the first to admit, even with an email notification, this workflow isn't exactly a walk in the park, but it should be a stopgap solution, since Java 21 is set to launch on September 19, 2023.</p>\n</div>\n<div class=\"paragraph\">\n<p>Keep your ears to the ground for more updates and thrilling developments as we forge Jenkins' future together.</p>\n</div>\n</div>\n</div>"
}